{"version":3,"file":"commonHelpers.js","sources":["../src/main.js"],"sourcesContent":["import iziToast from \"izitoast\";\nimport \"izitoast/dist/css/iziToast.min.css\";\nimport SimpleLightbox from \"simplelightbox\";\nimport \"simplelightbox/dist/simple-lightbox.min.css\";\nimport axios from \"axios\";\n\nconst api = axios.create({\n  baseURL: \"https://pixabay.com/api/\",\n  params: {\n    key: \"41856327-3235cf4f5968f0d75f22e6e35\",\n    language: \"en\",\n    image_type: \"photo\",\n    orientation: \"horizontal\",\n    safesearch: true,\n  },\n});\n\nconst searchForm = document.getElementById(\"search-form\");\nconst imageGallery = document.getElementById(\"image-gallery\");\nconst loadMoreBtn = document.getElementById(\"load-more\");\nconst loadMoreSpinner = document.getElementById(\"spinner\");\n\nlet lightbox;\nlet currentPage = 1;\nlet pageSize = 40;\nlet currentQuery = \"\";\nlet isLastPage = false;\nlet pageQuntity;\n\nconst scrollPage = () => {\n  const galleryItem = document.querySelector('.gallery-item');\n  const galleryItemHeight = galleryItem.getBoundingClientRect().height;\n  window.scrollBy({\n    top: galleryItemHeight * 2,\n    behavior: 'smooth',\n  });\n}\nsearchForm.addEventListener('submit', async (event) => {\n  \n  event.preventDefault();\n  const query = new FormData(event.currentTarget).get('query');\n  if (!query) return;\n\n  currentQuery = query;\n  currentPage = 1;\n\n  try {\n    toggleSpinner(true);\n    const data = await fetchImages();\n    pageQuntity = data.totalHits;\n    if (currentPage === Math.ceil(pageQuntity / pageSize)) {\n      loadMoreBtn.classList.add('is-hidden');\n      theEnd();\n    } else {\n      loadMoreBtn.classList.remove('is-hidden');\n    }\n    displayImages(data.hits);\n  } catch (error) {\n    showError();\n  } finally {\n    toggleSpinner(false);\n  }\n});\n\nloadMoreBtn.addEventListener('click', async () => { \n  currentPage += 1;\n  console.log(currentPage);\n  \n  if (currentPage === Math.ceil(pageQuntity / pageSize)) {\n    loadMoreBtn.classList.add('is-hidden');\n    theEnd();\n  } else {\n    loadMoreBtn.classList.remove('is-hidden');\n    \n  }\n  await fetchAndDisplayImages();\n  scrollPage();\n  \n});\n\nasync function fetchImages() {\n  const response = await api.get(\"\", {\n    params: {\n      q: currentQuery,\n      page: currentPage,\n      per_page: pageSize,\n    },\n  });\n  return response.data;\n}\nasync function fetchAndDisplayImages() {\n  try {\n    toggleSpinner(true);\n    const data = await fetchImages();\n    appendImages(data.hits);\n  } catch (error) {\n    // theEnd();\n    showError();\n  } finally {\n    toggleSpinner(false);\n  }\n}\n\nfunction displayImages(images) {\n  if (images.length === 0) {\n    loadMoreBtn.classList.add('is-hidden');\n    showError();\n    return;\n    \n  }\n\n   loadMoreBtn.classList.remove(\"is-hidden\");\n  toggleSpinner(false);\n\n  const imageElements = images.map(createImageElement);\n  imageGallery.innerHTML = \"\";\n  imageGallery.append(...imageElements);\n\n  if (currentPage === Math.ceil(pageQuntity / pageSize)) {\n    loadMoreBtn.classList.add('is-hidden');\n  }\n  initializeLightbox();\n}\n\nfunction appendImages(images) {\n  if (images.length === 0) {\n    isLastPage = true;\n    loadMoreBtn.classList.add(\"is-hidden\");\n    // toggleLoadMoreBtn(false);\n    toggleSpinner(false);\n    theEnd();\n    return;\n  }\n\n  const imageElements = images.map(createImageElement);\n  imageGallery.append(...imageElements);\n  initializeLightbox();\n}\n\nfunction createImageElement(image) {\n  const link = document.createElement(\"a\");\n  link.href = image.largeImageURL;\n  link.setAttribute(\"data-lightbox\", \"image-gallery\");\n  link.innerHTML = `\n    <div class=\"gallery-item\">\n      <img src=\"${image.webformatURL}\" alt=\"${image.tags}\">\n    </div>\n  `;\n  return link;\n}\nfunction initializeLightbox() {\n  if (lightbox) {\n    lightbox.refresh();\n  } else {\n    lightbox = new SimpleLightbox('.gallery a');\n  }\n}\n\nfunction theEnd() {\n  \n  iziToast.info({\n    title: \"Info\",\n    message: \"We're sorry, but you've reached the end of search results\",\n    position: \"topRight\",\n  });\n}\n\nfunction showError() {\n  imageGallery.innerHTML = \"\";\n  iziToast.error({\n    title: \"Error\",\n    message: \"Sorry, there are no images matching your search query. Please try again!\",\n    position: \"center\",\n  });\n}\n\nfunction toggleSpinner(show) {\n  loadMoreSpinner.classList.toggle(\"is-hidden\", !show);\n}"],"names":["api","axios","searchForm","imageGallery","loadMoreBtn","loadMoreSpinner","lightbox","currentPage","pageSize","currentQuery","pageQuntity","scrollPage","galleryItemHeight","event","query","toggleSpinner","data","fetchImages","theEnd","displayImages","showError","fetchAndDisplayImages","appendImages","images","imageElements","createImageElement","initializeLightbox","image","link","SimpleLightbox","iziToast","show"],"mappings":"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"}